{"version":3,"sources":["webpack:///src/app/paypal/paypal.page.html","webpack:///src/app/paypal/paypal-routing.module.ts","webpack:///src/app/paypal/paypal.module.ts","webpack:///src/app/paypal/paypal.page.scss","webpack:///src/app/paypal/paypal.page.ts"],"names":["routes","path","component","PaypalPageRoutingModule","imports","forChild","exports","PaypalPageModule","declarations","PaypalPage","afAuth","nacCtrl","alertController","afstore","payPal","loadingController","changeDetection","paymentAmount","currency","cart","self","onAuthStateChanged","user","userUID","uid","getCart","detectChanges","collection","valueChanges","pipe","toPromise","retailers","console","log","item","listing","thisListing","filter","currentListing","listingID","toLowerCase","indexOf","forEach","element","quantityCart","quantity","Error","name","presentAlert","navigateRoot","setTimeout","window","Buttons","createOrder","data","actions","toFixed","order","create","purchase_units","amount","value","onApprove","capture","then","details","date","Date","doc","update","orders","FieldValue","arrayUnion","description","retailerUID","isCurrent","arrayRemove","price","totalPrice","currentRetailer","email","Email","send","SecureToken","To","From","Subject","Body","message","decrement","increment","listings","quantityArr","set","type","deleteTime","error","isListed","alert","payer","given_name","err","render","get","querySnapshot","cart1","push","init","PayPalEnvironmentProduction","PayPalEnvironmentSandbox","prepareToRender","toString","payment","renderSinglePaymentUI","res","errorMessage","promise","Promise","resolve","resolveFunction","header","buttons","text","handler","present","selector","template"],"mappings":"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","file":"paypal-paypal-module-es5.js","sourcesContent":["export default \"<ion-header style=\\\"text-align: center\\\">\\n  <ion-toolbar color=\\\"primary\\\" mode=\\\"ios\\\">\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-back-button [text]=\\\"Back\\\" defaultHref=\\\"/tabs/tabs/tab3\\\"></ion-back-button>\\n    </ion-buttons>\\n    <ion-title>\\n      Good Food\\n    </ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content>\\n  <div *ngFor=\\\"let item of cart\\\">\\n    <ion-card>      \\n      <ion-card-header>\\n        <ion-card-title>{{item.name}}</ion-card-title>      \\n      </ion-card-header>\\n      <ion-card-content>\\n        <p> Quantity: {{item.quantityCart}} </p>\\n        <p> Price: ${{item.totalPrice | number:'1.2-2'}} </p>\\n      </ion-card-content>\\n    </ion-card>\\n  </div>\\n\\n  <ion-toolbar position=\\\"bottom\\\" style=\\\"text-align: center\\\">\\n    <div class=\\\"ion-text-end\\\" id=\\\"subtotal\\\">\\n      <ion-text > <p style=\\\"font-size: large;\\\"> Subtotal ${{paymentAmount | number:'1.2-2'}} </p></ion-text> \\n      <ion-text > <p style=\\\"font-size: large;\\\"> Tax $-</p></ion-text> \\n      <ion-text > <p id=\\\"total\\\"> TOTAL ${{paymentAmount | number:'1.2-2'}} </p></ion-text> \\n    </div>  \\n    <div id=\\\"paypal-button-container\\\" ></div>  \\n  </ion-toolbar>\\n\\n \\n</ion-content>\\n\\n\\n\\n<!-- <ion-footer class=\\\"ion-no-border\\\">\\n   <ion-toolbar position=\\\"bottom\\\" style=\\\"text-align: center;\\\">\\n    <div class=\\\"ion-text-end\\\" id=\\\"subtotal\\\">\\n      <ion-text > <p style=\\\"font-size: large;\\\"> Subtotal ${{paymentAmount | number:'1.2-2'}} </p></ion-text> \\n      <ion-text > <p style=\\\"font-size: large;\\\"> Tax $-</p></ion-text> \\n      <ion-text > <p id=\\\"total\\\"> TOTAL ${{paymentAmount | number:'1.2-2'}} </p></ion-text> \\n    </div>  \\n    <div id=\\\"paypal-button-container\\\"></div>   \\n    <div class=\\\"paypal_div\\\">\\n    <ion-button class=\\\"paypal_button\\\" expand=\\\"full\\\" color=\\\"warning\\\" (click)=\\\"payWithPayPal()\\\">Pay with PayPal</ion-button>\\n    \\n  </div> \\n </ion-toolbar>\\n</ion-footer> -->\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { PaypalPage } from './paypal.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: PaypalPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class PaypalPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { PaypalPageRoutingModule } from './paypal-routing.module';\n\nimport { PaypalPage } from './paypal.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    PaypalPageRoutingModule\n  ],\n  declarations: [PaypalPage]\n})\nexport class PaypalPageModule {}\n","export default \".paypal_button {\\n  font-family: Verdana;\\n  font-weight: bold;\\n}\\n\\np {\\n  padding-right: 2%;\\n  font-size: large;\\n}\\n\\n#total {\\n  font-size: large;\\n  font-weight: bold;\\n}\\n\\n.paypal_div {\\n  padding-bottom: 2%;\\n  padding-left: 2%;\\n  padding-right: 2%;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvcGF5cGFsL3BheXBhbC5wYWdlLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDSSxvQkFBQTtFQUNBLGlCQUFBO0FBQ0o7O0FBRUE7RUFDSSxpQkFBQTtFQUNBLGdCQUFBO0FBQ0o7O0FBRUE7RUFDSSxnQkFBQTtFQUNBLGlCQUFBO0FBQ0o7O0FBRUE7RUFDSSxrQkFBQTtFQUNBLGdCQUFBO0VBQ0EsaUJBQUE7QUFDSiIsImZpbGUiOiJzcmMvYXBwL3BheXBhbC9wYXlwYWwucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLnBheXBhbF9idXR0b257XG4gICAgZm9udC1mYW1pbHk6IFZlcmRhbmE7XG4gICAgZm9udC13ZWlnaHQ6IGJvbGQ7XG59XG5cbnB7XG4gICAgcGFkZGluZy1yaWdodDogMiU7XG4gICAgZm9udC1zaXplOiBsYXJnZTtcbn1cblxuI3RvdGFse1xuICAgIGZvbnQtc2l6ZTogbGFyZ2U7XG4gICAgZm9udC13ZWlnaHQ6IGJvbGQ7XG59XG5cbi5wYXlwYWxfZGl2e1xuICAgIHBhZGRpbmctYm90dG9tOiAyJTtcbiAgICBwYWRkaW5nLWxlZnQ6IDIlO1xuICAgIHBhZGRpbmctcmlnaHQ6IDIlO1xufSJdfQ== */\";","import { ChangeDetectorRef, Component, OnInit } from '@angular/core';\nimport { PayPal, PayPalPayment, PayPalConfiguration } from '@ionic-native/paypal/ngx'\nimport { AlertController, LoadingController, NavController } from '@ionic/angular';\nimport { AngularFirestore } from '@angular/fire/firestore';\nimport { AngularFireAuth } from '@angular/fire/auth';\nimport * as firebase from 'firebase/app';\nimport { first } from 'rxjs/operators';\n\ndeclare var Email: any;\n\n@Component({\n  selector: 'app-paypal',\n  templateUrl: './paypal.page.html',\n  styleUrls: ['./paypal.page.scss'],\n})\nexport class PaypalPage implements OnInit {\n  paymentAmount = 0;\n  currency: string = 'USD';\n  cart = [];\n  userUID;\n  date;\n  listing;\n  currentRetailer;\n  retailers: any[];\n\n  constructor(public afAuth: AngularFireAuth, private nacCtrl: NavController, public alertController: AlertController, public afstore: AngularFirestore, private payPal: PayPal, public loadingController: LoadingController, public changeDetection: ChangeDetectorRef){}\n\n  ngOnInit() {\n    let self = this\n    this.cart = []\n    this.paymentAmount = 0;\n    \n    this.afAuth.onAuthStateChanged(async function(user) {        \n      if (user) {        \n        self.userUID = user.uid        \n        await self.getCart();  \n        self.changeDetection.detectChanges();\n        self.retailers = await self.afstore.collection('users').valueChanges().pipe(first()).toPromise();\n        console.log(self.retailers);\n\n        try{\n          for(var item of self.cart){ \n            self.listing = await self.afstore.collection('listings').valueChanges().pipe(first()).toPromise();\n            let thisListing: any[] = self.listing.filter(currentListing => {\n              if (currentListing.listingID && item.listingID) {\n                return (currentListing.listingID.toLowerCase().indexOf(item.listingID.toLowerCase()) > -1);\n              }\n            });\n            thisListing.forEach(element => {\n              if(item.quantityCart>element.quantity){\n                throw new Error(\"Sorry, unfortunately there is not enough quantity to complete the \" + element.name + \" order. Please edit the quantity to be less than or equal to \" + element.quantity +\".\");\n                \n              }           \n            });\n          } \n          \n        }\n        catch(error){\n          console.log(error);\n          self.presentAlert(error);\n          self.nacCtrl.navigateRoot(['/tabs/tabs/tab3']);\n        } \n\n      }\n    });\n\n   \n    setTimeout(() => {\n        // Render the PayPal button into #paypal-button-container\n        \n        <any>window['paypal'].Buttons({\n\n          // Set up the transaction\n          createOrder: function (data, actions) {\n           \n            console.log(self.paymentAmount.toFixed(2));\n\n            return actions.order.create({\n              purchase_units: [{\n                amount: {\n                  value: self.paymentAmount.toFixed(2)\n                }\n              }]\n            });\n          },\n  \n          // Finalize the transaction\n          onApprove: function (data, actions) {\n            return actions.order.capture()\n              .then(function (details) {\n                // Show a success message to the buyer\n                console.log(self.cart)\n                for(var item of self.cart){ \n                  self.date = new Date();     \n                  self.afstore.doc(`users/${self.userUID}`).update({\n                    orders: firebase.firestore.FieldValue.arrayUnion({\n                      name: item.name,\n                      description: item.description,\n                      listingID: item.listingID,\n                      retailerUID: item.retailerUID,\n                      isCurrent: true,\n                      date: self.date\n                    })\n                  })\n            \n                  self.afstore.doc(`users/${self.userUID}`).update({\n                    cart: firebase.firestore.FieldValue.arrayRemove({\n                      name: item.name,\n                      description: item.description,\n                      listingID: item.listingID,\n                      retailerUID: item.retailerUID,\n                      quantity: item.quantity,\n                      quantityCart: item.quantityCart,\n                      price: item.price,\n                      totalPrice: item.totalPrice\n                    })\n                  })  \n                  \n                  self.afstore.doc(`users/${item.retailerUID}`).update({\n                    orders: firebase.firestore.FieldValue.arrayUnion({\n                      name: item.name,\n                      description: item.description,\n                      listingID: item.listingID,\n                      retailerUID: item.retailerUID,\n                      userUID: self.userUID,\n                      isCurrent: true,\n                      date: self.date\n                    })\n                  })\n\n                  //add Email\n                  self.currentRetailer = self.retailers.filter(currentListing => {\n                    if (currentListing.retailerUID && item.retailerUID) {\n                      return (currentListing.retailerUID.toLowerCase().indexOf(item.retailerUID.toLowerCase()) > -1);\n                    }\n                  });\n                  console.log(self.currentRetailer);\n                  console.log(`${self.currentRetailer[0].email}`);\n                  Email.send({\n                    SecureToken : \"c11c8a65-d4f9-45b7-8c2a-61f9c48e0ea7\",\n                    To : `${self.currentRetailer[0].email}`,\n                    From : 'goodfoodinnova@gmail.com',\n                    Subject : \"New Good Food Order\",\n                    Body : 'Hello ' + self.currentRetailer[0].name + ', you have an order for your listing: ' + item.name + '. Please check the Good Food application for more details. Thank you!'\n                  }).then(\n                    message => console.log(message)\n                  );    \n\n            \n                  if(item.quantityCart>0){\n                    const decrement = firebase.firestore.FieldValue.increment(-item.quantityCart);\n                    console.log(self.listing)\n                    let thisListing: any[] = self.listing.filter(currentListing => {\n                    if (currentListing.listingID && item.listingID) {\n                      return (currentListing.listingID.toLowerCase().indexOf(item.listingID.toLowerCase()) > -1);\n                    }\n                    });\n\n                    console.log(thisListing);\n            \n                    thisListing.forEach(element => {\n                      if(item.quantityCart==element.quantity){\n                        console.log(self.currentRetailer[0].listings)\n                        var quantityArr = self.currentRetailer[0].listings.filter(currentListing => {\n                          if (currentListing.listingID && item.listingID) {\n                            return (currentListing.listingID.toLowerCase().indexOf(item.listingID.toLowerCase()) > -1);\n                          }\n                        }); \n\n                        self.afstore.collection('archive').doc(item.listingID).set({\n                          name: item.name,\n                          description: item.description,\n                          listingID: item.listingID,\n                          price: item.price,\n                          type: \"Listing\",\n                          deleteTime: new Date()\n                        })\n                        .then(function() {\n                            console.log(\"Document successfully written!\");\n                        })\n                        .catch(function(error) {\n                            console.error(\"Error writing document: \", error);\n                        });\n                        \n                        self.afstore.collection('listings').doc(item.listingID).delete();\n                        //change isListed\n                        self.afstore.doc(`users/${item.retailerUID}`).update({\n                          listings: firebase.firestore.FieldValue.arrayUnion({\n                            name: item.name,\n                            description: item.description,\n                            listingID: item.listingID,\n                            price: item.price,\n                            quantity: quantityArr[0].quantity,\n                            isListed: false\n                          })\n                        })\n\n                        self.afstore.doc(`users/${item.retailerUID}`).update({\n                          listings: firebase.firestore.FieldValue.arrayRemove({\n                            name: item.name,\n                            description: item.description,\n                            listingID: item.listingID,\n                            price: item.price,\n                            quantity: quantityArr[0].quantity,\n                            isListed: true\n                          })\n                        })\n                       \n                      }\n                      else{           \n                      self.afstore.doc(`listings/${item.listingID}`).update({\n                        quantity: decrement\n                      })\n                    }\n                    });\n                  }\n                }\n                self.nacCtrl.navigateRoot(['/tabs/tabs/tab4']);\n                self.cart = []\n                console.log(\"checkout complete!\")\n                alert('Transaction completed by ' + details.payer.name.given_name + '!');\n\n              })\n              .catch(err => {\n                console.log(err);\n                self.presentAlert(err);\n                self.nacCtrl.navigateRoot(['/tabs/tabs/tab3']);\n              })\n          }\n        }).render('#paypal-button-container');\n       }, 10)\n        \n  }\n  \n  ionViewWillEnter(){\n    this.cart = []\n    this.paymentAmount = 0;\n    let self = this;\n    this.afAuth.onAuthStateChanged(async function(user) {        \n      if (user) {        \n        self.userUID = user.uid        \n        await self.getCart();  \n        self.changeDetection.detectChanges();\n      }\n    });    \n  }\n\n  async getCart(){    \n    var self = this;\n    await this.afstore.doc(`users/${this.userUID}`).get().toPromise().then(function(querySnapshot) {\n      self.cart = []\n      self.paymentAmount = 0;\n      var cart1 = querySnapshot.get(\"cart\");\n      self.changeDetection.detectChanges(); \n      cart1.forEach(element => {\n        self.cart.push(element);\n        self.paymentAmount += element.totalPrice          \n        });\n                    \n    })\n    .catch(function(error) {\n        console.log(\"Error getting documents\");\n    }); \n    \n    console.log(this.cart)\n    this.changeDetection.detectChanges();     \n  }\n\n  async payWithPayPal() {\n    try{\n      for(var item of this.cart){ \n        this.listing = await this.afstore.collection('listings').valueChanges().pipe(first()).toPromise();\n        let thisListing: any[] = this.listing.filter(currentListing => {\n          if (currentListing.listingID && item.listingID) {\n            return (currentListing.listingID.toLowerCase().indexOf(item.listingID.toLowerCase()) > -1);\n          }\n        });\n        thisListing.forEach(element => {\n          if(item.quantityCart>element.quantity){\n            throw new Error(\"Sorry, unfortunately there is not enough quantity to complete the \" + element.name + \" order. Please edit the quantity to be less than or equal to \" + element.quantity +\".\");\n          }           \n        });\n    } \n      \n    this.payPal.init({\n      PayPalEnvironmentProduction: 'AZdLLjUn69oERT3rIneIeL6pYWh7iFidUWTrDRfpPDh7F9zcETzH9lYNMbRbnWoRwCX506xQJX0sDoQa',\n      PayPalEnvironmentSandbox: 'AZdLLjUn69oERT3rIneIeL6pYWh7iFidUWTrDRfpPDh7F9zcETzH9lYNMbRbnWoRwCX506xQJX0sDoQa'\n    }).then(() => {\n      // Environments: PayPalEnvironmentNoNetwork, PayPalEnvironmentSandbox, PayPalEnvironmentProduction\n      this.payPal.prepareToRender('PayPalEnvironmentSandbox', new PayPalConfiguration({\n        // Only needed if you get an \"Internal Service Error\" after PayPal login!\n//payPalShippingAddressOption: 2 // PayPalShippingAddressOptionPayPal\n})).then(() => {\n\n\n  console.log(this.paymentAmount.toString())\n  let payment = new PayPalPayment(this.paymentAmount.toString(), this.currency, 'Description', 'sale');\n  this.payPal.renderSinglePaymentUI(payment).then((res) => {\n    console.log(res);\n    // Successfully paid\n\n    // Example sandbox response\n    //\n    // {\n    //   \"client\": {\n    //     \"environment\": \"sandbox\",\n    //     \"product_name\": \"PayPal iOS SDK\",\n    //     \"paypal_sdk_version\": \"2.16.0\",\n    //     \"platform\": \"iOS\"\n    //   },\n    //   \"response_type\": \"payment\",\n    //   \"response\": {\n    //     \"id\": \"PAY-1AB23456CD789012EF34GHIJ\",\n    //     \"state\": \"approved\",\n    //     \"create_time\": \"2016-10-03T13:33:33Z\",\n    //     \"intent\": \"sale\"\n    //   }\n    // }\n\n    for(var item of this.cart){ \n      this.date = new Date();     \n      this.afstore.doc(`users/${this.userUID}`).update({\n        orders: firebase.firestore.FieldValue.arrayUnion({\n          name: item.name,\n          description: item.description,\n          listingID: item.listingID,\n          retailerUID: item.retailerUID,\n          isCurrent: true,\n          date: this.date\n        })\n      })\n\n      this.afstore.doc(`users/${this.userUID}`).update({\n        cart: firebase.firestore.FieldValue.arrayRemove({\n          name: item.name,\n          description: item.description,\n          listingID: item.listingID,\n          retailerUID: item.retailerUID,\n          quantity: item.quantity,\n          quantityCart: item.quantityCart,\n          price: item.price,\n          totalPrice: item.totalPrice\n        })\n      })  \n      \n      this.afstore.doc(`users/${item.retailerUID}`).update({\n        orders: firebase.firestore.FieldValue.arrayUnion({\n          name: item.name,\n          description: item.description,\n          listingID: item.listingID,\n          retailerUID: item.retailerUID,\n          userUID: this.userUID,\n          isCurrent: true,\n          date: this.date\n        })\n      })\n\n      if(item.quantityCart>0){\n        const decrement = firebase.firestore.FieldValue.increment(-item.quantityCart);\n        let thisListing: any[] = this.listing.filter(currentListing => {\n        if (currentListing.listingID && item.listingID) {\n          return (currentListing.listingID.toLowerCase().indexOf(item.listingID.toLowerCase()) > -1);\n        }\n        });\n\n        thisListing.forEach(element => {\n          if(item.quantityCart==element.quantity){\n            console.log(element);\n            console.log(item);\n            \n\n\n            this.afstore.collection('listings').doc(item.listingID).delete()\n            //TODO: add to archive\n          }\n          else{           \n          this.afstore.doc(`listings/${item.listingID}`).update({\n            quantity: decrement\n          })\n        }\n        });\n      }\n    }\n    this.nacCtrl.navigateRoot(['/tabs/tabs/tab4']);\n    this.cart = []\n    console.log(\"checkout complete!\")\n\n\n  }, (error) => {\n    // Error or render dialog closed without being successful\n    console.log(error);\n   \n  });\n  }, (error) => {\n        // Error in configuration\n        console.log(error)\n        \n      });\n    }, (error) => {\n      // Error in initialization, maybe PayPal isn't supported or something else\n      console.log(error)\n    });\n\n  }\n  catch(error){\n    console.log(error);\n    this.presentAlert(error);\n    this.nacCtrl.navigateRoot(['/tabs/tabs/tab3']);\n  }  \n\n  }\n  \n  public async presentAlert(errorMessage) : Promise<boolean> {\n    let resolveFunction: (confirm: boolean) => void;\n    const promise = new Promise<boolean>(resolve => {\n      resolveFunction = resolve;\n    });\n    \n    const alert = await this.alertController.create({\n      header: 'Order Error',\n      message: errorMessage,\n      buttons: [\n        {\n          text: 'OK',\n            handler: () => resolveFunction(true)\n        }\n      ]\n    });\n  \n    await alert.present();\n    return promise;\n  }  \n  \n}"]}