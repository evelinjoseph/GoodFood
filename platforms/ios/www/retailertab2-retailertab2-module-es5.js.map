{"version":3,"sources":["webpack:///src/app/retailertab2/retailertab2.page.html","webpack:///src/app/retailertab2/retailertab2-routing.module.ts","webpack:///src/app/retailertab2/retailertab2.module.ts","webpack:///src/app/retailertab2/retailertab2.page.scss","webpack:///src/app/retailertab2/retailertab2.page.ts"],"names":["routes","path","component","Retailertab2PageRoutingModule","imports","forChild","exports","Retailertab2PageModule","declarations","Retailertab2Page","listingService","afAuth","afstore","changeDetection","alertCtrl","isReady","self","onAuthStateChanged","user","retailerUID","uid","items","doc","retailerItems","valueChanges","collection","get","toPromise","userRef","data","retailerType","location","detectChanges","console","log","listing","presentAlertDelete","confirm","update","listings","FieldValue","arrayRemove","description","listingID","price","quantity","isListed","set","type","deleteTime","Date","then","error","deleteListing","presentAlertUnpublish","arrayUnion","promise","Promise","resolve","resolveFunction","create","header","message","buttons","text","handler","alert","present","selector","template"],"mappings":"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","file":"retailertab2-retailertab2-module-es5.js","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar mode=\\\"ios\\\" color=\\\"primary\\\">\\n    <ion-title>Good Food</ion-title>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-menu-button autoHide=\\\"false\\\"></ion-menu-button>\\n    </ion-buttons>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content fullscreen [hidden]=\\\"!isReady\\\">\\n\\n  <div *ngIf=\\\"!((retailerItems | async)?.isVerified) ; else verified\\\" class=\\\"centerText\\\">\\n    <ion-text class=\\\"centerText\\\" color=\\\"primary\\\" style=\\\"text-align: center\\\">\\n      <p>Your account is not verified yet, please wait until verified to gain access to this tab!</p>\\n    </ion-text>\\n  </div>\\n\\n  <ng-template #verified>\\n      <div *ngFor=\\\"let item of ((retailerItems | async)?.listings)\\\">\\n        <ion-card>\\n\\n        <ion-item>\\n          <ion-card-title class=\\\"ion-text-wrap\\\" [routerLink]=\\\"['/retailer-listing']\\\" [queryParams]=\\\"{ id: item.listingID }\\\" routerDirection=\\\"forward\\\">{{((retailerItems | async)?.name)}}</ion-card-title>\\n        \\n        </ion-item>\\n      \\n        <ion-card-content > \\n          <div [routerLink]=\\\"['/retailer-listing']\\\" [queryParams]=\\\"{ id: item.listingID }\\\" routerDirection=\\\"forward\\\">\\n\\n          <p> Price: ${{item.price | number:'1.2-2'}}</p>\\n          <p> Description: {{item.description}}</p>\\n          <p> Location: {{location}}</p>\\n          <p> Retailer Type: {{retailerType}}</p>\\n          \\n          </div>\\n          <ion-button  (click)=\\\"delete(item)\\\" fill=\\\"outline\\\" slot=\\\"end\\\">Delete</ion-button> \\n          <ion-button  *ngIf=\\\"item.isListed\\\" (click)=\\\"unpublish(item)\\\" slot=\\\"end\\\">Unpublish</ion-button>       \\n        </ion-card-content>\\n\\n        \\n      </ion-card>\\n      </div>      \\n        <ion-text *ngIf=\\\"((retailerItems | async)?.listings).length <= 0\\\" class=\\\"centerText\\\" color=\\\"primary\\\" style=\\\"text-align: center\\\">\\n          <p>There are no listings currently.</p>\\n        </ion-text>\\n  </ng-template>\\n</ion-content>\\n\\n<ion-footer class=\\\"ion-no-border\\\">\\n  <div *ngIf=\\\"((retailerItems | async)?.isVerified)\\\">\\n    <ion-toolbar position=\\\"bottom\\\" style=\\\"text-align: center;\\\">     \\n      <ion-button size =\\\"large\\\" [routerLink]=\\\"['/new-listing']\\\" routerDirection=\\\"forward\\\">Add Listing</ion-button>    \\n    </ion-toolbar>\\n  </div>\\n</ion-footer>\\n\\n\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { Retailertab2Page } from './retailertab2.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: Retailertab2Page\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class Retailertab2PageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { Retailertab2PageRoutingModule } from './retailertab2-routing.module';\n\nimport { Retailertab2Page } from './retailertab2.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    Retailertab2PageRoutingModule\n  ],\n  declarations: [Retailertab2Page]\n})\nexport class Retailertab2PageModule {}\n","export default \".centerText {\\n  height: 90% !important;\\n  display: flex !important;\\n  align-items: center !important;\\n  justify-content: center !important;\\n  align-content: center !important;\\n  flex-wrap: wrap !important;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvcmV0YWlsZXJ0YWIyL3JldGFpbGVydGFiMi5wYWdlLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDSSxzQkFBQTtFQUNBLHdCQUFBO0VBQ0EsOEJBQUE7RUFDQSxrQ0FBQTtFQUNBLGdDQUFBO0VBQ0EsMEJBQUE7QUFDSiIsImZpbGUiOiJzcmMvYXBwL3JldGFpbGVydGFiMi9yZXRhaWxlcnRhYjIucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLmNlbnRlclRleHQge1xuICAgIGhlaWdodDogOTAlICFpbXBvcnRhbnQ7XG4gICAgZGlzcGxheTogZmxleCAhaW1wb3J0YW50O1xuICAgIGFsaWduLWl0ZW1zOiBjZW50ZXIgIWltcG9ydGFudDtcbiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlciAhaW1wb3J0YW50O1xuICAgIGFsaWduLWNvbnRlbnQ6IGNlbnRlciFpbXBvcnRhbnQ7XG4gICAgZmxleC13cmFwOiB3cmFwICFpbXBvcnRhbnQ7ICAgIFxuIH0iXX0= */\";","import { Component, OnInit, ChangeDetectorRef } from '@angular/core';\nimport { AngularFireAuth } from '@angular/fire/auth';\nimport { AlertController } from '@ionic/angular';\nimport { AngularFirestore } from '@angular/fire/firestore';\nimport * as firebase from 'firebase/app';\nimport { first } from 'rxjs/operators';\nimport { ListingsService } from '../listings.service';\n\n@Component({\n  selector: 'app-retailertab2',\n  templateUrl: './retailertab2.page.html',\n  styleUrls: ['./retailertab2.page.scss'],\n})\nexport class Retailertab2Page implements OnInit {\n\n  public listings: any[];\n  retailerUID;\n  retailerItems;\n  items;\n  retailerType;\n  location;\n  isReady = false;\n\n  constructor(public listingService: ListingsService, public afAuth: AngularFireAuth, private afstore: AngularFirestore, private changeDetection: ChangeDetectorRef, public alertCtrl: AlertController) {}\n\n  ngOnInit() {\n    var self = this\n    this.afAuth.onAuthStateChanged(async function(user) {        \n      if (user) {        \n        self.retailerUID = user.uid\n        self.items = self.afstore.doc(`users/${self.retailerUID}`);        \n        self.retailerItems = self.items.valueChanges();        \n        var userRef = (await self.afstore.collection(\"users\").doc(self.retailerUID).get().toPromise()).data()\n        self.retailerType = userRef.retailerType;\n        self.location = userRef.location;\n        self.isReady = true;\n        self.changeDetection.detectChanges();        \n\n      }\n      else{\n        console.log('no user signed in');\n      }\n    });\n\n    \n  }\n\n  ionViewWillEnter(){\n    if(this.items){\n      this.retailerItems = this.items.valueChanges();\n      this.changeDetection.detectChanges();\n      this.isReady = true;\n    }    \n  }\n  \n  async delete(listing){\n\n    const confirm = await this.presentAlertDelete();\n    if (confirm) {\n    this.afstore.doc(`users/${this.retailerUID}`).update({\n      listings: firebase.firestore.FieldValue.arrayRemove({\n        description: listing.description,\n        listingID: listing.listingID,\n        price: listing.price,\n        quantity:listing.quantity,\n        isListed: listing.isListed\n      })\n    })\n    \n    this.afstore.collection('listings').doc(listing.listingID).delete();\n\n    //adding to archive after deletion\n    this.afstore.collection('archive').doc(listing.listingID).set({      \n      description: listing.description,\n      listingID: listing.listingID,\n      price: listing.price,\n      type: \"Listing\",\n      deleteTime: new Date()\n    })\n    .then(function() {\n        console.log(\"Document successfully written!\");\n    })\n    .catch(function(error) {\n        console.error(\"Error writing document: \", error);\n    });\n\n    //deleting from carts after deletion\n    await this.listingService.deleteListing(listing)\n  }\n  }\n\n  async unpublish(listing){\n\n    const confirm = await this.presentAlertUnpublish();\n    if (confirm) {\n\n      this.afstore.doc(`users/${this.retailerUID}`).update({\n        listings: firebase.firestore.FieldValue.arrayUnion({          \n          description: listing.description,\n          listingID: listing.listingID,\n          price: listing.price,\n          quantity:listing.quantity,\n          isListed: false\n        })\n      })\n\n    this.afstore.doc(`users/${this.retailerUID}`).update({\n      listings: firebase.firestore.FieldValue.arrayRemove({        \n        description: listing.description,\n        listingID: listing.listingID,\n        price: listing.price,\n        quantity:listing.quantity,\n        isListed: listing.isListed\n      })\n    })\n    \n    // delete from carts\n    await this.listingService.deleteListing(listing)\n    this.afstore.collection('listings').doc(listing.listingID).delete();\n\n    \n  }\n  }\n\n  async presentAlertDelete() : Promise<boolean> {\n    let resolveFunction: (confirm: boolean) => void;\n    const promise = new Promise<boolean>(resolve => {\n      resolveFunction = resolve;\n    });\n    const alert = await this.alertCtrl.create({\n      header: 'Confirm Delete',\n      message: 'Are you sure you want to delete this listing?',\n      buttons: [\n        {\n          text: 'Yes',\n            handler: () => resolveFunction(true)\n        }, {\n          text: 'No',\n          handler: () => resolveFunction(false)\n        }\n      ]\n    });\n\n    await alert.present();\n    return promise;\n  }\n\n  async presentAlertUnpublish() : Promise<boolean> {\n    let resolveFunction: (confirm: boolean) => void;\n    const promise = new Promise<boolean>(resolve => {\n      resolveFunction = resolve;\n    });\n    const alert = await this.alertCtrl.create({\n      header: 'Confirm Unpublish',\n      message: 'Are you sure you want to unpublish this listing?',\n      buttons: [\n        {\n          text: 'Yes',\n            handler: () => resolveFunction(true)\n        }, {\n          text: 'No',\n          handler: () => resolveFunction(false)\n        }\n      ]\n    });\n\n    await alert.present();\n    return promise;\n  }\n \n}"]}