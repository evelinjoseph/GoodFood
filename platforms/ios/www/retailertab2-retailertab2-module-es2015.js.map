{"version":3,"sources":["./src/app/retailertab2/retailertab2.page.html","./src/app/retailertab2/retailertab2-routing.module.ts","./src/app/retailertab2/retailertab2.module.ts","./src/app/retailertab2/retailertab2.page.scss","./src/app/retailertab2/retailertab2.page.ts"],"names":[],"mappings":"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","file":"retailertab2-retailertab2-module-es2015.js","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar mode=\\\"ios\\\" color=\\\"primary\\\">\\n    <ion-title>Good Food</ion-title>\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-menu-button autoHide=\\\"false\\\"></ion-menu-button>\\n    </ion-buttons>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content fullscreen [hidden]=\\\"!isReady\\\">\\n\\n  <div *ngIf=\\\"!((retailerItems | async)?.isVerified) ; else verified\\\" class=\\\"centerText\\\">\\n    <ion-text class=\\\"centerText\\\" color=\\\"primary\\\" style=\\\"text-align: center\\\">\\n      <p>Your account is not verified yet, please wait until verified to gain access to this tab!</p>\\n    </ion-text>\\n  </div>\\n\\n  <ng-template #verified>\\n      <div *ngFor=\\\"let item of ((retailerItems | async)?.listings)\\\">\\n        <ion-card>\\n\\n        <ion-item>\\n          <ion-card-title class=\\\"ion-text-wrap\\\" [routerLink]=\\\"['/retailer-listing']\\\" [queryParams]=\\\"{ id: item.listingID }\\\" routerDirection=\\\"forward\\\">{{((retailerItems | async)?.name)}}</ion-card-title>\\n        \\n        </ion-item>\\n      \\n        <ion-card-content > \\n          <div [routerLink]=\\\"['/retailer-listing']\\\" [queryParams]=\\\"{ id: item.listingID }\\\" routerDirection=\\\"forward\\\">\\n\\n          <p> Price: ${{item.price | number:'1.2-2'}}</p>\\n          <p> Description: {{item.description}}</p>\\n          <p> Location: {{location}}</p>\\n          <p> Retailer Type: {{retailerType}}</p>\\n          \\n          </div>\\n          <ion-button  (click)=\\\"delete(item)\\\" fill=\\\"outline\\\" slot=\\\"end\\\">Delete</ion-button> \\n          <ion-button  *ngIf=\\\"item.isListed\\\" (click)=\\\"unpublish(item)\\\" slot=\\\"end\\\">Unpublish</ion-button>       \\n        </ion-card-content>\\n\\n        \\n      </ion-card>\\n      </div>      \\n        <ion-text *ngIf=\\\"((retailerItems | async)?.listings).length <= 0\\\" class=\\\"centerText\\\" color=\\\"primary\\\" style=\\\"text-align: center\\\">\\n          <p>There are no listings currently.</p>\\n        </ion-text>\\n  </ng-template>\\n</ion-content>\\n\\n<ion-footer class=\\\"ion-no-border\\\">\\n  <div *ngIf=\\\"((retailerItems | async)?.isVerified)\\\">\\n    <ion-toolbar position=\\\"bottom\\\" style=\\\"text-align: center;\\\">     \\n      <ion-button size =\\\"large\\\" [routerLink]=\\\"['/new-listing']\\\" routerDirection=\\\"forward\\\">Add Listing</ion-button>    \\n    </ion-toolbar>\\n  </div>\\n</ion-footer>\\n\\n\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { Retailertab2Page } from './retailertab2.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: Retailertab2Page\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class Retailertab2PageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { Retailertab2PageRoutingModule } from './retailertab2-routing.module';\n\nimport { Retailertab2Page } from './retailertab2.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    Retailertab2PageRoutingModule\n  ],\n  declarations: [Retailertab2Page]\n})\nexport class Retailertab2PageModule {}\n","export default \".centerText {\\n  height: 90% !important;\\n  display: flex !important;\\n  align-items: center !important;\\n  justify-content: center !important;\\n  align-content: center !important;\\n  flex-wrap: wrap !important;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvcmV0YWlsZXJ0YWIyL3JldGFpbGVydGFiMi5wYWdlLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDSSxzQkFBQTtFQUNBLHdCQUFBO0VBQ0EsOEJBQUE7RUFDQSxrQ0FBQTtFQUNBLGdDQUFBO0VBQ0EsMEJBQUE7QUFDSiIsImZpbGUiOiJzcmMvYXBwL3JldGFpbGVydGFiMi9yZXRhaWxlcnRhYjIucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLmNlbnRlclRleHQge1xuICAgIGhlaWdodDogOTAlICFpbXBvcnRhbnQ7XG4gICAgZGlzcGxheTogZmxleCAhaW1wb3J0YW50O1xuICAgIGFsaWduLWl0ZW1zOiBjZW50ZXIgIWltcG9ydGFudDtcbiAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlciAhaW1wb3J0YW50O1xuICAgIGFsaWduLWNvbnRlbnQ6IGNlbnRlciFpbXBvcnRhbnQ7XG4gICAgZmxleC13cmFwOiB3cmFwICFpbXBvcnRhbnQ7ICAgIFxuIH0iXX0= */\";","import { Component, OnInit, ChangeDetectorRef } from '@angular/core';\nimport { AngularFireAuth } from '@angular/fire/auth';\nimport { AlertController } from '@ionic/angular';\nimport { AngularFirestore } from '@angular/fire/firestore';\nimport * as firebase from 'firebase/app';\nimport { first } from 'rxjs/operators';\nimport { ListingsService } from '../listings.service';\n\n@Component({\n  selector: 'app-retailertab2',\n  templateUrl: './retailertab2.page.html',\n  styleUrls: ['./retailertab2.page.scss'],\n})\nexport class Retailertab2Page implements OnInit {\n\n  public listings: any[];\n  retailerUID;\n  retailerItems;\n  items;\n  retailerType;\n  location;\n  isReady = false;\n\n  constructor(public listingService: ListingsService, public afAuth: AngularFireAuth, private afstore: AngularFirestore, private changeDetection: ChangeDetectorRef, public alertCtrl: AlertController) {}\n\n  ngOnInit() {\n    var self = this\n    this.afAuth.onAuthStateChanged(async function(user) {        \n      if (user) {        \n        self.retailerUID = user.uid\n        self.items = self.afstore.doc(`users/${self.retailerUID}`);        \n        self.retailerItems = self.items.valueChanges();        \n        var userRef = (await self.afstore.collection(\"users\").doc(self.retailerUID).get().toPromise()).data()\n        self.retailerType = userRef.retailerType;\n        self.location = userRef.location;\n        self.isReady = true;\n        self.changeDetection.detectChanges();        \n\n      }\n      else{\n        console.log('no user signed in');\n      }\n    });\n\n    \n  }\n\n  ionViewWillEnter(){\n    if(this.items){\n      this.retailerItems = this.items.valueChanges();\n      this.changeDetection.detectChanges();\n      this.isReady = true;\n    }    \n  }\n  \n  async delete(listing){\n\n    const confirm = await this.presentAlertDelete();\n    if (confirm) {\n    this.afstore.doc(`users/${this.retailerUID}`).update({\n      listings: firebase.firestore.FieldValue.arrayRemove({\n        description: listing.description,\n        listingID: listing.listingID,\n        price: listing.price,\n        quantity:listing.quantity,\n        isListed: listing.isListed\n      })\n    })\n    \n    this.afstore.collection('listings').doc(listing.listingID).delete();\n\n    //adding to archive after deletion\n    this.afstore.collection('archive').doc(listing.listingID).set({      \n      description: listing.description,\n      listingID: listing.listingID,\n      price: listing.price,\n      type: \"Listing\",\n      deleteTime: new Date()\n    })\n    .then(function() {\n        console.log(\"Document successfully written!\");\n    })\n    .catch(function(error) {\n        console.error(\"Error writing document: \", error);\n    });\n\n    //deleting from carts after deletion\n    await this.listingService.deleteListing(listing)\n  }\n  }\n\n  async unpublish(listing){\n\n    const confirm = await this.presentAlertUnpublish();\n    if (confirm) {\n\n      this.afstore.doc(`users/${this.retailerUID}`).update({\n        listings: firebase.firestore.FieldValue.arrayUnion({          \n          description: listing.description,\n          listingID: listing.listingID,\n          price: listing.price,\n          quantity:listing.quantity,\n          isListed: false\n        })\n      })\n\n    this.afstore.doc(`users/${this.retailerUID}`).update({\n      listings: firebase.firestore.FieldValue.arrayRemove({        \n        description: listing.description,\n        listingID: listing.listingID,\n        price: listing.price,\n        quantity:listing.quantity,\n        isListed: listing.isListed\n      })\n    })\n    \n    // delete from carts\n    await this.listingService.deleteListing(listing)\n    this.afstore.collection('listings').doc(listing.listingID).delete();\n\n    \n  }\n  }\n\n  async presentAlertDelete() : Promise<boolean> {\n    let resolveFunction: (confirm: boolean) => void;\n    const promise = new Promise<boolean>(resolve => {\n      resolveFunction = resolve;\n    });\n    const alert = await this.alertCtrl.create({\n      header: 'Confirm Delete',\n      message: 'Are you sure you want to delete this listing?',\n      buttons: [\n        {\n          text: 'Yes',\n            handler: () => resolveFunction(true)\n        }, {\n          text: 'No',\n          handler: () => resolveFunction(false)\n        }\n      ]\n    });\n\n    await alert.present();\n    return promise;\n  }\n\n  async presentAlertUnpublish() : Promise<boolean> {\n    let resolveFunction: (confirm: boolean) => void;\n    const promise = new Promise<boolean>(resolve => {\n      resolveFunction = resolve;\n    });\n    const alert = await this.alertCtrl.create({\n      header: 'Confirm Unpublish',\n      message: 'Are you sure you want to unpublish this listing?',\n      buttons: [\n        {\n          text: 'Yes',\n            handler: () => resolveFunction(true)\n        }, {\n          text: 'No',\n          handler: () => resolveFunction(false)\n        }\n      ]\n    });\n\n    await alert.present();\n    return promise;\n  }\n \n}"],"sourceRoot":"webpack:///"}