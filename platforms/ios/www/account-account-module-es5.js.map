{"version":3,"sources":["webpack:///src/app/account/account.page.html","webpack:///src/app/account/account-routing.module.ts","webpack:///src/app/account/account.module.ts","webpack:///src/app/account/account.page.scss","webpack:///src/app/account/account.page.ts"],"names":["routes","path","component","AccountPageRoutingModule","imports","forChild","exports","AccountPageModule","declarations","AccountPage","nacCtrl","activatedRoute","firestore","changeDetection","afAuth","alertController","buttonText","isRead","self","onAuthStateChanged","user","userUID","uid","collection","doc","get","toPromise","userRef","data","firstName","firstname","lastName","lastname","email","detectChanges","console","log","message","trim","length","update","error","presentAlert","errorMessage","promise","Promise","resolve","resolveFunction","create","header","buttons","text","handler","alert","present","navigateRoot","presentAlertDelete","confirm","currentUser","set","deleteTime","Date","isRetailer","orders","type","inputs","name","placeholder","signInWithEmailAndPassword","password","then","selector","template"],"mappings":"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","file":"account-account-module-es5.js","sourcesContent":["export default \"<ion-header style=\\\"text-align: center\\\">\\n  <ion-toolbar color=\\\"primary\\\" mode=\\\"ios\\\">\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-back-button [text]=\\\"Back\\\" defaultHref=\\\"/tabs/tabs/tab1\\\"></ion-back-button>\\n    </ion-buttons>\\n    <ion-title>\\n      Good Food\\n    </ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content>\\n\\n  <h1 style=\\\"text-align: center;\\\"> {{firstName}} {{lastName}} </h1>\\n \\n  <ion-item >    \\n    <ion-label>\\n      First Name:\\n    </ion-label>\\n    <ion-textarea placeholder=\\\"{{ firstName }}\\\" [readonly]=\\\"isRead\\\" [(ngModel)]=\\\"firstName\\\" ></ion-textarea>\\n  </ion-item>\\n\\n  <ion-item >    \\n    <ion-label>\\n      Last Name:\\n    </ion-label>\\n    <ion-textarea placeholder=\\\"{{ lastName }}\\\" [readonly]=\\\"isRead\\\" [(ngModel)]=\\\"lastName\\\" ></ion-textarea>\\n  </ion-item>\\n\\n   <ion-item >    \\n        <ion-label>\\n          User UID:\\n        </ion-label>\\n        <ion-textarea placeholder=\\\"{{ userUID }}\\\" [readonly]=true  ></ion-textarea>\\n    </ion-item>\\n\\n     <ion-item >    \\n        <ion-label>\\n          Email Address:\\n        </ion-label>\\n        <ion-textarea placeholder=\\\"{{ email }}\\\" [readonly]=true  ></ion-textarea>\\n    </ion-item>\\n \\n    \\n    <div style=\\\"text-align: center\\\"> \\n      \\n      <section >\\n        <br>\\n        <ion-button expand=\\\"block\\\" (click)=\\\"edit()\\\">{{buttonText}}</ion-button>\\n      </section>\\n\\n      <section>\\n        <ion-button expand=\\\"block\\\" (click)=\\\"updatePassword()\\\">Update Password</ion-button>\\n      </section>\\n\\n      <section >\\n        <br>\\n        <ion-text color=\\\"danger\\\"  (click)=\\\"deleteAccount()\\\">\\n          <u>Delete Account?</u>\\n        </ion-text>\\n      </section>\\n    </div>\\n\\n</ion-content>\\n\";","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { AccountPage } from './account.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: AccountPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class AccountPageRoutingModule {}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { AccountPageRoutingModule } from './account-routing.module';\n\nimport { AccountPage } from './account.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    AccountPageRoutingModule\n  ],\n  declarations: [AccountPage]\n})\nexport class AccountPageModule {}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL2FjY291bnQvYWNjb3VudC5wYWdlLnNjc3MifQ== */\";","import { ChangeDetectorRef, Component, OnInit } from '@angular/core';\nimport { AngularFireAuth } from '@angular/fire/auth';\nimport { AngularFirestore } from '@angular/fire/firestore';\nimport { ActivatedRoute } from '@angular/router';\nimport * as firebase from 'firebase/app';\nimport { AlertController } from '@ionic/angular';\nimport { NavController } from '@ionic/angular';\n\n@Component({\n  selector: 'app-account',\n  templateUrl: './account.page.html',\n  styleUrls: ['./account.page.scss'],\n})\nexport class AccountPage implements OnInit {\n\n  userUID;\n  firstName;\n  lastName;\n  email;\n  buttonText: string = \"Edit\";\n  isRead: boolean = true;\n\n  constructor(public nacCtrl: NavController, private activatedRoute: ActivatedRoute, private firestore: AngularFirestore, private changeDetection: ChangeDetectorRef, public afAuth: AngularFireAuth, public alertController: AlertController) { }\n\n  async ngOnInit() {\n    try{\n    var self = this;\n    await (this.afAuth.onAuthStateChanged(async function(user) {             \n      if (user) {        \n        self.userUID = user.uid\n          var userRef = (await self.firestore.collection(\"users\").doc(self.userUID).get().toPromise()).data()          \n              self.firstName = userRef.firstname;\n              self.lastName = userRef.lastname; \n              self.email = userRef.email; \n              self.changeDetection.detectChanges();                 \n      }\n      else{\n        console.log('no user signed in');\n      }\n    }));    \n      \n  }\n  catch(error){\n    console.log(error.message)\n  }\n  this.changeDetection.detectChanges();\n}\n\nedit()\n  {\n    if(this.buttonText == \"Edit\"){\n      this.isRead = false;\n      this.buttonText = \"Save\";\n     }\n    else{  \n      \n      const { firstName, lastName } = this\n      if(firstName.trim().length != 0 && lastName.trim().length != 0){\n        try{\n          this.firestore.doc(`users/${this.userUID}`).update({          \n            firstname: this.firstName,\n            lastname: this.lastName              \n          })\n          this.isRead = true;\n          this.buttonText = \"Edit\";\n        }catch(error){  \n          console.log(error.message)\n        }   \n      }else {\n       this.presentAlert(\"Please enter a value for name\");   \n           \n      }  \n      \n    }   \n  }\n  \n  public async presentAlert(errorMessage) : Promise<boolean> {\n    let resolveFunction: (confirm: boolean) => void;\n    const promise = new Promise<boolean>(resolve => {\n      resolveFunction = resolve;\n    });\n    \n    const alert = await this.alertController.create({\n      header: 'Error',\n      message: errorMessage,\n      buttons: [\n        {\n          text: 'OK',\n            handler: () => resolveFunction(true)\n        }\n      ]\n    });\n    \n  await alert.present();\n  return promise;\n}\n\n  updatePassword(){        \n    this.nacCtrl.navigateRoot(['./update-password'])\n  }\n\n  async deleteAccount(){\n    //let self = this;\n    const confirm = await this.presentAlertDelete();\n    var userRef = (await this.firestore.collection(\"users\").doc(this.userUID).get().toPromise()).data() \n    if (confirm) {  \n     try{\n\n      (await this.afAuth.currentUser).delete();\n\n      this.firestore.collection('archive').doc(this.userUID).set({\n            deleteTime: new Date(),\n            email: userRef.email,\n            firstname: userRef.firstname,\n            lastname: userRef.lastname,\n            isRetailer: userRef.isRetailer,\n            orders: userRef.orders,\n            type: \"User Account\"\n       });\n\n       this.firestore.doc(`users/${this.userUID}`).delete();\n       this.nacCtrl.navigateRoot(['./login']);\n       console.log(\"user deleted\");\n     }\n     catch(error){\n       console.log(error)\n     }\n\n      // firebase.auth().currentUser.delete().then(function() {\n      //   // User deleted.       \n      //   console.log(\"entered then\")  \n      //   console.log(self.userUID);\n      //   console.log(userRef);\n      //   self.firestore.collection('archive').doc(self.userUID).set({\n      //     email: userRef.email,\n      //     firstname: userRef.firstname,\n      //     lastname: userRef.lastname,\n      //     isRetailer: userRef.isRetailer,\n      //     orders: userRef.orders,\n      //     type: \"User Account\"\n      //   })\n      //   .then(function() {\n      //       console.log(\"Document successfully written to Archive!\");\n      //   })\n      //   .catch(function(error) {\n      //       console.error(\"Error writing document: \", error);\n      //   });        \n      //   self.firestore.doc(`users/${self.userUID}`).delete();\n      //   self.nacCtrl.navigateRoot(['./login'])\n      //   console.log(\"user deleted\")\n      // }).catch(function(error) {\n      //   console.log(error)\n      //   console.log(\"Error deleting user\")\n      // });\n    }\n  }\n\n  async presentAlertDelete() : Promise<boolean> {\n    let resolveFunction: (confirm: boolean) => void;\n    const promise = new Promise<boolean>(resolve => {\n      resolveFunction = resolve;\n    });\n    const alert = await this.alertController.create({\n      header: 'Confirm Delete',\n      message: 'Are you sure you want to delete this account? This is a permanent deletion and cannot be undone. Please enter your password to continue',\n      inputs: [        \n        {\n          name: 'password',\n          placeholder: 'Password',\n          type: 'password'\n        }\n      ],\n      buttons: [\n        {\n          text: 'Cancel',\n          handler: () => resolveFunction(false)\n        },\n        {\n          text: 'Yes',\n          handler: data => {\n            this.afAuth.signInWithEmailAndPassword(firebase.auth().currentUser.email, data.password).then(function(){\n              console.log(\"signed in\")\n              resolveFunction(true)\n            }).catch(function(error){\n              console.log(error.message)\n            })           \n                      \n          }\n        }\n      ]\n    });\n\n    await alert.present();\n    return promise;\n  }\n}\n"]}