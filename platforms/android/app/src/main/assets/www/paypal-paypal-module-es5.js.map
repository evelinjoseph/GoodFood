{"version":3,"sources":["webpack:///src/app/paypal/paypal.page.html","webpack:///src/app/paypal/paypal-routing.module.ts","webpack:///src/app/paypal/paypal.module.ts","webpack:///src/app/paypal/paypal.page.scss","webpack:///src/app/paypal/paypal.page.ts"],"names":["routes","path","component","PaypalPageRoutingModule","imports","forChild","exports","PaypalPageModule","declarations","PaypalPage","afAuth","nacCtrl","alertController","afstore","payPal","loadingController","changeDetection","paymentAmount","currency","cart","self","onAuthStateChanged","user","userUID","uid","getCart","detectChanges","collection","valueChanges","pipe","toPromise","retailers","item","listing","thisListing","filter","currentListing","listingID","toLowerCase","indexOf","forEach","element","quantityCart","quantity","Error","console","log","presentAlert","navigateRoot","setTimeout","window","Buttons","createOrder","data","actions","toFixed","order","create","purchase_units","amount","value","onApprove","capture","then","details","date","Date","doc","update","orders","FieldValue","arrayUnion","description","retailerUID","isCurrent","arrayRemove","price","totalPrice","currentRetailer","email","Email","send","SecureToken","To","From","Subject","Body","name","message","decrement","increment","listings","quantityArr","set","type","deleteTime","error","isListed","presentConfirmation","err","render","find","get","querySnapshot","cart1","push","init","PayPalEnvironmentProduction","PayPalEnvironmentSandbox","prepareToRender","toString","payment","renderSinglePaymentUI","res","errorMessage","promise","Promise","resolve","resolveFunction","header","buttons","text","handler","alert","present","selector","template"],"mappings":"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","file":"paypal-paypal-module-es5.js","sourcesContent":["export default \"<ion-header style=\\\"text-align: center\\\">\\r\\n  <ion-toolbar color=\\\"primary\\\" mode=\\\"ios\\\">\\r\\n    <ion-buttons slot=\\\"start\\\">\\r\\n      <ion-back-button [text]=\\\"Back\\\" defaultHref=\\\"/tabs/tabs/tab3\\\"></ion-back-button>\\r\\n    </ion-buttons>\\r\\n    <ion-title>\\r\\n      Good Food\\r\\n    </ion-title>\\r\\n  </ion-toolbar>\\r\\n</ion-header>\\r\\n\\r\\n<ion-content>\\r\\n  <div *ngFor=\\\"let item of cart\\\">\\r\\n    <ion-card>      \\r\\n      <ion-card-header>\\r\\n        <ion-card-title>{{getRetailer(item.retailerUID)}}</ion-card-title>      \\r\\n      </ion-card-header>\\r\\n      <ion-card-content>\\r\\n        <p> Quantity: {{item.quantityCart}} </p>\\r\\n        <p> Price: ${{item.totalPrice | number:'1.2-2'}} </p>\\r\\n      </ion-card-content>\\r\\n    </ion-card>\\r\\n  </div>\\r\\n\\r\\n  <ion-toolbar position=\\\"bottom\\\" style=\\\"text-align: center\\\">\\r\\n    <div class=\\\"ion-text-end\\\" id=\\\"subtotal\\\">\\r\\n      <ion-text > <p style=\\\"font-size: large;\\\"> Subtotal ${{paymentAmount | number:'1.2-2'}} </p></ion-text> \\r\\n      <ion-text > <p style=\\\"font-size: large;\\\"> Tax $-</p></ion-text> \\r\\n      <ion-text > <p id=\\\"total\\\"> TOTAL ${{paymentAmount | number:'1.2-2'}} </p></ion-text> \\r\\n    </div>  \\r\\n    <div id=\\\"paypal-button-container\\\" ></div>  \\r\\n  </ion-toolbar>\\r\\n\\r\\n \\r\\n</ion-content>\\r\\n\\r\\n\\r\\n\\r\\n<!-- <ion-footer class=\\\"ion-no-border\\\">\\r\\n   <ion-toolbar position=\\\"bottom\\\" style=\\\"text-align: center;\\\">\\r\\n    <div class=\\\"ion-text-end\\\" id=\\\"subtotal\\\">\\r\\n      <ion-text > <p style=\\\"font-size: large;\\\"> Subtotal ${{paymentAmount | number:'1.2-2'}} </p></ion-text> \\r\\n      <ion-text > <p style=\\\"font-size: large;\\\"> Tax $-</p></ion-text> \\r\\n      <ion-text > <p id=\\\"total\\\"> TOTAL ${{paymentAmount | number:'1.2-2'}} </p></ion-text> \\r\\n    </div>  \\r\\n    <div id=\\\"paypal-button-container\\\"></div>   \\r\\n    <div class=\\\"paypal_div\\\">\\r\\n    <ion-button class=\\\"paypal_button\\\" expand=\\\"full\\\" color=\\\"warning\\\" (click)=\\\"payWithPayPal()\\\">Pay with PayPal</ion-button>\\r\\n    \\r\\n  </div> \\r\\n </ion-toolbar>\\r\\n</ion-footer> -->\";","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { PaypalPage } from './paypal.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: PaypalPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class PaypalPageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { PaypalPageRoutingModule } from './paypal-routing.module';\r\n\r\nimport { PaypalPage } from './paypal.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    PaypalPageRoutingModule\r\n  ],\r\n  declarations: [PaypalPage]\r\n})\r\nexport class PaypalPageModule {}\r\n","export default \".paypal_button {\\n  font-family: Verdana;\\n  font-weight: bold;\\n}\\n\\np {\\n  padding-right: 2%;\\n  font-size: large;\\n}\\n\\n#total {\\n  font-size: large;\\n  font-weight: bold;\\n}\\n\\n.paypal_div {\\n  padding-bottom: 2%;\\n  padding-left: 2%;\\n  padding-right: 2%;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hcHAvcGF5cGFsL3BheXBhbC5wYWdlLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDSSxvQkFBQTtFQUNBLGlCQUFBO0FBQ0o7O0FBRUE7RUFDSSxpQkFBQTtFQUNBLGdCQUFBO0FBQ0o7O0FBRUE7RUFDSSxnQkFBQTtFQUNBLGlCQUFBO0FBQ0o7O0FBRUE7RUFDSSxrQkFBQTtFQUNBLGdCQUFBO0VBQ0EsaUJBQUE7QUFDSiIsImZpbGUiOiJzcmMvYXBwL3BheXBhbC9wYXlwYWwucGFnZS5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLnBheXBhbF9idXR0b257XHJcbiAgICBmb250LWZhbWlseTogVmVyZGFuYTtcclxuICAgIGZvbnQtd2VpZ2h0OiBib2xkO1xyXG59XHJcblxyXG5we1xyXG4gICAgcGFkZGluZy1yaWdodDogMiU7XHJcbiAgICBmb250LXNpemU6IGxhcmdlO1xyXG59XHJcblxyXG4jdG90YWx7XHJcbiAgICBmb250LXNpemU6IGxhcmdlO1xyXG4gICAgZm9udC13ZWlnaHQ6IGJvbGQ7XHJcbn1cclxuXHJcbi5wYXlwYWxfZGl2e1xyXG4gICAgcGFkZGluZy1ib3R0b206IDIlO1xyXG4gICAgcGFkZGluZy1sZWZ0OiAyJTtcclxuICAgIHBhZGRpbmctcmlnaHQ6IDIlO1xyXG59Il19 */\";","import { ChangeDetectorRef, Component, OnInit } from '@angular/core';\r\nimport { PayPal, PayPalPayment, PayPalConfiguration } from '@ionic-native/paypal/ngx'\r\nimport { AlertController, LoadingController, NavController } from '@ionic/angular';\r\nimport { AngularFirestore } from '@angular/fire/firestore';\r\nimport { AngularFireAuth } from '@angular/fire/auth';\r\nimport * as firebase from 'firebase/app';\r\nimport { first } from 'rxjs/operators';\r\n\r\ndeclare var Email: any;\r\n\r\n@Component({\r\n  selector: 'app-paypal',\r\n  templateUrl: './paypal.page.html',\r\n  styleUrls: ['./paypal.page.scss'],\r\n})\r\nexport class PaypalPage implements OnInit {\r\n  paymentAmount = 0;\r\n  currency: string = 'USD';\r\n  cart = [];\r\n  userUID;\r\n  date;\r\n  listing;\r\n  currentRetailer;\r\n  retailers: any[];\r\n\r\n  constructor(public afAuth: AngularFireAuth, private nacCtrl: NavController, public alertController: AlertController, public afstore: AngularFirestore, private payPal: PayPal, public loadingController: LoadingController, public changeDetection: ChangeDetectorRef){}\r\n\r\n  ngOnInit() {\r\n    let self = this\r\n    this.cart = []\r\n    this.paymentAmount = 0;\r\n    \r\n    this.afAuth.onAuthStateChanged(async function(user) {        \r\n      if (user) {        \r\n        self.userUID = user.uid        \r\n        await self.getCart();  \r\n        self.changeDetection.detectChanges();\r\n        self.retailers = await self.afstore.collection('users').valueChanges().pipe(first()).toPromise();\r\n        //console.log(self.retailers);\r\n\r\n        try{\r\n          for(var item of self.cart){ \r\n            self.listing = await self.afstore.collection('listings').valueChanges().pipe(first()).toPromise();\r\n            let thisListing: any[] = self.listing.filter(currentListing => {\r\n              if (currentListing.listingID && item.listingID) {\r\n                return (currentListing.listingID.toLowerCase().indexOf(item.listingID.toLowerCase()) > -1);\r\n              }\r\n            });\r\n            thisListing.forEach(element => {\r\n              if(item.quantityCart>element.quantity){\r\n                throw new Error(\"Sorry, unfortunately there is not enough quantity to complete the order. Please edit the quantity to be less than or equal to \" + element.quantity +\".\");\r\n                \r\n              }           \r\n            });\r\n          } \r\n          \r\n        }\r\n        catch(error){\r\n          console.log(error);\r\n          self.presentAlert(error);\r\n          self.nacCtrl.navigateRoot(['/tabs/tabs/tab3']);\r\n        } \r\n\r\n      }\r\n    });\r\n\r\n   \r\n    setTimeout(() => {\r\n        // Render the PayPal button into #paypal-button-container\r\n        \r\n        <any>window['paypal'].Buttons({\r\n          // Set up the transaction\r\n          createOrder: function (data, actions) {\r\n           \r\n            console.log(self.paymentAmount.toFixed(2));\r\n\r\n            return actions.order.create({\r\n              purchase_units: [{\r\n                amount: {\r\n                  value: self.paymentAmount.toFixed(2)\r\n                }\r\n              }]\r\n            });\r\n          },\r\n  \r\n          // Finalize the transaction\r\n          onApprove: function (data, actions) {\r\n            return actions.order.capture()\r\n              .then(function (details) {\r\n                // Show a success message to the buyer\r\n                console.log(self.cart)\r\n                for(var item of self.cart){ \r\n                  self.date = new Date();     \r\n                  self.afstore.doc(`users/${self.userUID}`).update({\r\n                    orders: firebase.firestore.FieldValue.arrayUnion({\r\n                      description: item.description,\r\n                      listingID: item.listingID,\r\n                      retailerUID: item.retailerUID,\r\n                      isCurrent: true,\r\n                      date: self.date\r\n                    })\r\n                  })\r\n            \r\n                  self.afstore.doc(`users/${self.userUID}`).update({\r\n                    cart: firebase.firestore.FieldValue.arrayRemove({\r\n                      description: item.description,\r\n                      listingID: item.listingID,\r\n                      retailerUID: item.retailerUID,\r\n                      quantity: item.quantity,\r\n                      quantityCart: item.quantityCart,\r\n                      price: item.price,\r\n                      totalPrice: item.totalPrice\r\n                    })\r\n                  })  \r\n                  \r\n                  self.afstore.doc(`users/${item.retailerUID}`).update({\r\n                    orders: firebase.firestore.FieldValue.arrayUnion({\r\n                      description: item.description,\r\n                      listingID: item.listingID,\r\n                      retailerUID: item.retailerUID,\r\n                      userUID: self.userUID,\r\n                      isCurrent: true,\r\n                      date: self.date\r\n                    })\r\n                  })\r\n\r\n                  //add Email\r\n                  self.currentRetailer = self.retailers.filter(currentListing => {\r\n                    if (currentListing.retailerUID && item.retailerUID) {\r\n                      return (currentListing.retailerUID.toLowerCase().indexOf(item.retailerUID.toLowerCase()) > -1);\r\n                    }\r\n                  });\r\n                  console.log(self.currentRetailer);\r\n                  console.log(`${self.currentRetailer[0].email}`);\r\n                  Email.send({\r\n                    SecureToken : \"c11c8a65-d4f9-45b7-8c2a-61f9c48e0ea7\",\r\n                    To : `${self.currentRetailer[0].email}`,\r\n                    From : 'goodfoodinnova@gmail.com',\r\n                    Subject : \"New Good Food Order\",\r\n                    Body : 'Hello ' + self.currentRetailer[0].name + ', you have an order for your listing. Please check the Good Food application for more details. Thank you!'\r\n                  }).then(\r\n                    message => console.log(message)\r\n                  );    \r\n\r\n            \r\n                  if(item.quantityCart>0){\r\n                    const decrement = firebase.firestore.FieldValue.increment(-item.quantityCart);\r\n                    console.log(self.listing)\r\n                    let thisListing: any[] = self.listing.filter(currentListing => {\r\n                    if (currentListing.listingID && item.listingID) {\r\n                      return (currentListing.listingID.toLowerCase().indexOf(item.listingID.toLowerCase()) > -1);\r\n                    }\r\n                    });\r\n\r\n                    //console.log(thisListing);\r\n            \r\n                    thisListing.forEach(element => {\r\n                      if(item.quantityCart==element.quantity){\r\n                        console.log(self.currentRetailer[0].listings)\r\n                        var quantityArr = self.currentRetailer[0].listings.filter(currentListing => {\r\n                          if (currentListing.listingID && item.listingID) {\r\n                            return (currentListing.listingID.toLowerCase().indexOf(item.listingID.toLowerCase()) > -1);\r\n                          }\r\n                        }); \r\n\r\n                        self.afstore.collection('archive').doc(item.listingID).set({\r\n                          description: item.description,\r\n                          listingID: item.listingID,\r\n                          price: item.price,\r\n                          type: \"Listing\",\r\n                          deleteTime: new Date()\r\n                        })\r\n                        .then(function() {\r\n                            console.log(\"Document successfully written!\");\r\n                        })\r\n                        .catch(function(error) {\r\n                            console.error(\"Error writing document: \", error);\r\n                        });\r\n                        \r\n                        self.afstore.collection('listings').doc(item.listingID).delete();\r\n                        //change isListed\r\n                        self.afstore.doc(`users/${item.retailerUID}`).update({\r\n                          listings: firebase.firestore.FieldValue.arrayUnion({                            \r\n                            description: item.description,\r\n                            listingID: item.listingID,\r\n                            price: item.price,\r\n                            quantity: quantityArr[0].quantity,\r\n                            isListed: false\r\n                          })\r\n                        })\r\n\r\n                        self.afstore.doc(`users/${item.retailerUID}`).update({\r\n                          listings: firebase.firestore.FieldValue.arrayRemove({                            \r\n                            description: item.description,\r\n                            listingID: item.listingID,\r\n                            price: item.price,\r\n                            quantity: quantityArr[0].quantity,\r\n                            isListed: true\r\n                          })\r\n                        })\r\n                       \r\n                      }\r\n                      else{           \r\n                      self.afstore.doc(`listings/${item.listingID}`).update({\r\n                        quantity: decrement\r\n                      })\r\n                    }\r\n                    });\r\n                  }\r\n                }\r\n                self.nacCtrl.navigateRoot(['/tabs/tabs/tab4']);\r\n                self.cart = []\r\n                console.log(\"checkout complete!\")\r\n                self.presentConfirmation('Transaction completed!');\r\n\r\n              })\r\n              .catch(err => {\r\n                console.log(err);\r\n                self.presentAlert(err);\r\n                self.nacCtrl.navigateRoot(['/tabs/tabs/tab3']);\r\n              })\r\n          }\r\n        }).render('#paypal-button-container');\r\n    }, 10)\r\n      \r\n        \r\n  }\r\n  \r\n  ionViewWillEnter(){\r\n    this.cart = []\r\n    this.paymentAmount = 0;\r\n    let self = this;\r\n    this.afAuth.onAuthStateChanged(async function(user) {        \r\n      if (user) {        \r\n        self.userUID = user.uid        \r\n        await self.getCart();  \r\n        self.changeDetection.detectChanges();\r\n        self.retailers = await self.afstore.collection('users').valueChanges().pipe(first()).toPromise();\r\n      }\r\n    });    \r\n  }\r\n\r\n  getRetailer(uid) : String{  \r\n    if(this.retailers){\r\n     const user = this.retailers.find(element => element.retailerUID == uid);    \r\n     return user.name;\r\n\r\n    }\r\n  }\r\n\r\n\r\n  async getCart(){    \r\n    var self = this;\r\n    await this.afstore.doc(`users/${this.userUID}`).get().toPromise().then(function(querySnapshot) {\r\n      self.cart = []\r\n      self.paymentAmount = 0;\r\n      var cart1 = querySnapshot.get(\"cart\");\r\n      self.changeDetection.detectChanges(); \r\n      cart1.forEach(element => {\r\n        self.cart.push(element);\r\n        self.paymentAmount += element.totalPrice          \r\n        });\r\n                    \r\n    })\r\n    .catch(function(error) {\r\n        console.log(\"Error getting documents\");\r\n    }); \r\n    \r\n    console.log(this.cart)\r\n    this.changeDetection.detectChanges();     \r\n  }\r\n  \r\n//not using this method due to the deprecation!\r\n  async payWithPayPal() {\r\n    try{\r\n      for(var item of this.cart){ \r\n        this.listing = await this.afstore.collection('listings').valueChanges().pipe(first()).toPromise();\r\n        let thisListing: any[] = this.listing.filter(currentListing => {\r\n          if (currentListing.listingID && item.listingID) {\r\n            return (currentListing.listingID.toLowerCase().indexOf(item.listingID.toLowerCase()) > -1);\r\n          }\r\n        });\r\n        thisListing.forEach(element => {\r\n          if(item.quantityCart>element.quantity){\r\n            throw new Error(\"Sorry, unfortunately there is not enough quantity to complete the order. Please edit the quantity to be less than or equal to \" + element.quantity +\".\");\r\n          }           \r\n        });\r\n    } \r\n      \r\n    this.payPal.init({\r\n      PayPalEnvironmentProduction: 'AZdLLjUn69oERT3rIneIeL6pYWh7iFidUWTrDRfpPDh7F9zcETzH9lYNMbRbnWoRwCX506xQJX0sDoQa',\r\n      PayPalEnvironmentSandbox: 'AZdLLjUn69oERT3rIneIeL6pYWh7iFidUWTrDRfpPDh7F9zcETzH9lYNMbRbnWoRwCX506xQJX0sDoQa'\r\n    }).then(() => {\r\n      // Environments: PayPalEnvironmentNoNetwork, PayPalEnvironmentSandbox, PayPalEnvironmentProduction\r\n      this.payPal.prepareToRender('PayPalEnvironmentSandbox', new PayPalConfiguration({\r\n        // Only needed if you get an \"Internal Service Error\" after PayPal login!\r\n//payPalShippingAddressOption: 2 // PayPalShippingAddressOptionPayPal\r\n})).then(() => {\r\n\r\n\r\n  console.log(this.paymentAmount.toString())\r\n  let payment = new PayPalPayment(this.paymentAmount.toString(), this.currency, 'Description', 'sale');\r\n  this.payPal.renderSinglePaymentUI(payment).then((res) => {\r\n    console.log(res);\r\n    // Successfully paid\r\n\r\n    // Example sandbox response\r\n    //\r\n    // {\r\n    //   \"client\": {\r\n    //     \"environment\": \"sandbox\",\r\n    //     \"product_name\": \"PayPal iOS SDK\",\r\n    //     \"paypal_sdk_version\": \"2.16.0\",\r\n    //     \"platform\": \"iOS\"\r\n    //   },\r\n    //   \"response_type\": \"payment\",\r\n    //   \"response\": {\r\n    //     \"id\": \"PAY-1AB23456CD789012EF34GHIJ\",\r\n    //     \"state\": \"approved\",\r\n    //     \"create_time\": \"2016-10-03T13:33:33Z\",\r\n    //     \"intent\": \"sale\"\r\n    //   }\r\n    // }\r\n\r\n    for(var item of this.cart){ \r\n      this.date = new Date();     \r\n      this.afstore.doc(`users/${this.userUID}`).update({\r\n        orders: firebase.firestore.FieldValue.arrayUnion({\r\n          description: item.description,\r\n          listingID: item.listingID,\r\n          retailerUID: item.retailerUID,\r\n          isCurrent: true,\r\n          date: this.date\r\n        })\r\n      })\r\n\r\n      this.afstore.doc(`users/${this.userUID}`).update({\r\n        cart: firebase.firestore.FieldValue.arrayRemove({\r\n          description: item.description,\r\n          listingID: item.listingID,\r\n          retailerUID: item.retailerUID,\r\n          quantity: item.quantity,\r\n          quantityCart: item.quantityCart,\r\n          price: item.price,\r\n          totalPrice: item.totalPrice\r\n        })\r\n      })  \r\n      \r\n      this.afstore.doc(`users/${item.retailerUID}`).update({\r\n        orders: firebase.firestore.FieldValue.arrayUnion({\r\n          description: item.description,\r\n          listingID: item.listingID,\r\n          retailerUID: item.retailerUID,\r\n          userUID: this.userUID,\r\n          isCurrent: true,\r\n          date: this.date\r\n        })\r\n      })\r\n\r\n      if(item.quantityCart>0){\r\n        const decrement = firebase.firestore.FieldValue.increment(-item.quantityCart);\r\n        let thisListing: any[] = this.listing.filter(currentListing => {\r\n        if (currentListing.listingID && item.listingID) {\r\n          return (currentListing.listingID.toLowerCase().indexOf(item.listingID.toLowerCase()) > -1);\r\n        }\r\n        });\r\n\r\n        thisListing.forEach(element => {\r\n          if(item.quantityCart==element.quantity){\r\n            console.log(element);\r\n            console.log(item);           \r\n\r\n\r\n            this.afstore.collection('listings').doc(item.listingID).delete()\r\n            \r\n          }\r\n          else{           \r\n          this.afstore.doc(`listings/${item.listingID}`).update({\r\n            quantity: decrement\r\n          })\r\n        }\r\n        });\r\n      }\r\n    }\r\n    this.nacCtrl.navigateRoot(['/tabs/tabs/tab4']);\r\n    this.cart = []\r\n    console.log(\"checkout complete!\")\r\n\r\n\r\n  }, (error) => {\r\n    // Error or render dialog closed without being successful\r\n    console.log(error);\r\n   \r\n  });\r\n  }, (error) => {\r\n        // Error in configuration\r\n        console.log(error)\r\n        \r\n      });\r\n    }, (error) => {\r\n      // Error in initialization, maybe PayPal isn't supported or something else\r\n      console.log(error)\r\n    });\r\n\r\n  }\r\n  catch(error){\r\n    console.log(error);\r\n    this.presentAlert(error);\r\n    this.nacCtrl.navigateRoot(['/tabs/tabs/tab3']);\r\n  }  \r\n\r\n  }\r\n  \r\npublic async presentAlert(errorMessage) : Promise<boolean> {\r\n    let resolveFunction: (confirm: boolean) => void;\r\n    const promise = new Promise<boolean>(resolve => {\r\n      resolveFunction = resolve;\r\n    });\r\n    \r\n    const alert = await this.alertController.create({\r\n      header: 'Order Error',\r\n      message: errorMessage,\r\n      buttons: [\r\n        {\r\n          text: 'OK',\r\n            handler: () => resolveFunction(true)\r\n        }\r\n      ]\r\n    });\r\n  \r\n    await alert.present();\r\n    return promise;\r\n  }  \r\n\r\n  public async presentConfirmation(message) : Promise<boolean> {\r\n    let resolveFunction: (confirm: boolean) => void;\r\n    const promise = new Promise<boolean>(resolve => {\r\n      resolveFunction = resolve;\r\n    });\r\n    \r\n    const alert = await this.alertController.create({\r\n      header: 'PayPal',\r\n      message: message,\r\n      buttons: [\r\n        {\r\n          text: 'OK',\r\n            handler: () => resolveFunction(true)\r\n        }\r\n      ]\r\n    });\r\n  \r\n    await alert.present();\r\n    return promise;\r\n  }  \r\n  \r\n}\r\n  \r\n\r\n\r\n"]}