{"version":3,"sources":["./src/app/account/account.page.html","./src/app/account/account-routing.module.ts","./src/app/account/account.module.ts","./src/app/account/account.page.scss","./src/app/account/account.page.ts"],"names":[],"mappings":"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","file":"account-account-module-es2015.js","sourcesContent":["export default \"<ion-header style=\\\"text-align: center\\\">\\r\\n  <ion-toolbar color=\\\"primary\\\" mode=\\\"ios\\\">\\r\\n    <ion-buttons slot=\\\"start\\\">\\r\\n      <ion-back-button [text]=\\\"Back\\\" defaultHref=\\\"/tabs/tabs/tab1\\\"></ion-back-button>\\r\\n    </ion-buttons>\\r\\n    <ion-title>\\r\\n      Good Food\\r\\n    </ion-title>\\r\\n  </ion-toolbar>\\r\\n</ion-header>\\r\\n\\r\\n<ion-content>\\r\\n\\r\\n  <h1 style=\\\"text-align: center;\\\"> {{firstName}} {{lastName}} </h1>\\r\\n \\r\\n  <ion-item >    \\r\\n    <ion-label>\\r\\n      First Name:\\r\\n    </ion-label>\\r\\n    <ion-textarea placeholder=\\\"{{ firstName }}\\\" [readonly]=\\\"isRead\\\" [(ngModel)]=\\\"firstName\\\" ></ion-textarea>\\r\\n  </ion-item>\\r\\n\\r\\n  <ion-item >    \\r\\n    <ion-label>\\r\\n      Last Name:\\r\\n    </ion-label>\\r\\n    <ion-textarea placeholder=\\\"{{ lastName }}\\\" [readonly]=\\\"isRead\\\" [(ngModel)]=\\\"lastName\\\" ></ion-textarea>\\r\\n  </ion-item>\\r\\n\\r\\n   <ion-item >    \\r\\n        <ion-label>\\r\\n          User UID:\\r\\n        </ion-label>\\r\\n        <ion-textarea placeholder=\\\"{{ userUID }}\\\" [readonly]=true  ></ion-textarea>\\r\\n    </ion-item>\\r\\n\\r\\n     <ion-item >    \\r\\n        <ion-label>\\r\\n          Email Address:\\r\\n        </ion-label>\\r\\n        <ion-textarea placeholder=\\\"{{ email }}\\\" [readonly]=true  ></ion-textarea>\\r\\n    </ion-item>\\r\\n \\r\\n    \\r\\n    <div style=\\\"text-align: center\\\"> \\r\\n      \\r\\n      <section >\\r\\n        <br>\\r\\n        <ion-button expand=\\\"block\\\" (click)=\\\"edit()\\\">{{buttonText}}</ion-button>\\r\\n      </section>\\r\\n\\r\\n      <section>\\r\\n        <ion-button expand=\\\"block\\\" (click)=\\\"updatePassword()\\\">Update Password</ion-button>\\r\\n      </section>\\r\\n\\r\\n      <section >\\r\\n        <br>\\r\\n        <ion-text color=\\\"danger\\\"  (click)=\\\"deleteAccount()\\\">\\r\\n          <u>Delete Account?</u>\\r\\n        </ion-text>\\r\\n      </section>\\r\\n    </div>\\r\\n\\r\\n</ion-content>\\r\\n\";","import { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { AccountPage } from './account.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: AccountPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class AccountPageRoutingModule {}\r\n","import { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { AccountPageRoutingModule } from './account-routing.module';\r\n\r\nimport { AccountPage } from './account.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    AccountPageRoutingModule\r\n  ],\r\n  declarations: [AccountPage]\r\n})\r\nexport class AccountPageModule {}\r\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL2FjY291bnQvYWNjb3VudC5wYWdlLnNjc3MifQ== */\";","import { ChangeDetectorRef, Component, OnInit } from '@angular/core';\r\nimport { AngularFireAuth } from '@angular/fire/auth';\r\nimport { AngularFirestore } from '@angular/fire/firestore';\r\nimport { ActivatedRoute } from '@angular/router';\r\nimport * as firebase from 'firebase/app';\r\nimport { AlertController } from '@ionic/angular';\r\nimport { NavController } from '@ionic/angular';\r\n\r\n@Component({\r\n  selector: 'app-account',\r\n  templateUrl: './account.page.html',\r\n  styleUrls: ['./account.page.scss'],\r\n})\r\nexport class AccountPage implements OnInit {\r\n\r\n  userUID;\r\n  firstName;\r\n  lastName;\r\n  email;\r\n  buttonText: string = \"Edit\";\r\n  isRead: boolean = true;\r\n\r\n  constructor(public nacCtrl: NavController, private activatedRoute: ActivatedRoute, private firestore: AngularFirestore, private changeDetection: ChangeDetectorRef, public afAuth: AngularFireAuth, public alertCtrl: AlertController) { }\r\n\r\n  async ngOnInit() {\r\n    try{\r\n    var self = this;\r\n    await (this.afAuth.onAuthStateChanged(async function(user) {             \r\n      if (user) {        \r\n        self.userUID = user.uid\r\n          var userRef = (await self.firestore.collection(\"users\").doc(self.userUID).get().toPromise()).data()          \r\n              self.firstName = userRef.firstname;\r\n              self.lastName = userRef.lastname; \r\n              self.email = userRef.email; \r\n              self.changeDetection.detectChanges();                 \r\n      }\r\n      else{\r\n        console.log('no user signed in');\r\n      }\r\n    }));    \r\n      \r\n  }\r\n  catch(error){\r\n    console.log(error.message)\r\n  }\r\n  this.changeDetection.detectChanges();\r\n}\r\n\r\nedit()\r\n  {\r\n    if(this.buttonText == \"Edit\"){\r\n      this.isRead = false;\r\n      this.buttonText = \"Save\";\r\n     }\r\n    else{\r\n      this.isRead = true;\r\n      this.buttonText = \"Edit\";\r\n      \r\n      const { firstName, lastName } = this\r\n      if(firstName.trim().length != 0 && lastName.trim().length != 0){\r\n        try{\r\n          this.firestore.doc(`users/${this.userUID}`).update({          \r\n            firstname: this.firstName,\r\n            lastname: this.lastName              \r\n          })\r\n        }catch(error){  \r\n          console.log(error.message)\r\n        }   \r\n      }else {\r\n       alert(\"Please enter a value for name\");       \r\n      }  \r\n      \r\n    }   \r\n  }\r\n\r\n  updatePassword(){        \r\n    this.nacCtrl.navigateRoot(['./update-password'])\r\n  }\r\n\r\n  async deleteAccount(){\r\n    //let self = this;\r\n    const confirm = await this.presentAlertDelete();\r\n    var userRef = (await this.firestore.collection(\"users\").doc(this.userUID).get().toPromise()).data() \r\n    if (confirm) {  \r\n     try{\r\n\r\n      (await this.afAuth.currentUser).delete();\r\n\r\n      this.firestore.collection('archive').doc(this.userUID).set({\r\n            deleteTime: new Date(),\r\n            email: userRef.email,\r\n            firstname: userRef.firstname,\r\n            lastname: userRef.lastname,\r\n            isRetailer: userRef.isRetailer,\r\n            orders: userRef.orders,\r\n            type: \"User Account\"\r\n       });\r\n\r\n       this.firestore.doc(`users/${this.userUID}`).delete();\r\n       this.nacCtrl.navigateRoot(['./login']);\r\n       console.log(\"user deleted\");\r\n     }\r\n     catch(error){\r\n       console.log(error)\r\n     }\r\n\r\n      // firebase.auth().currentUser.delete().then(function() {\r\n      //   // User deleted.       \r\n      //   console.log(\"entered then\")  \r\n      //   console.log(self.userUID);\r\n      //   console.log(userRef);\r\n      //   self.firestore.collection('archive').doc(self.userUID).set({\r\n      //     email: userRef.email,\r\n      //     firstname: userRef.firstname,\r\n      //     lastname: userRef.lastname,\r\n      //     isRetailer: userRef.isRetailer,\r\n      //     orders: userRef.orders,\r\n      //     type: \"User Account\"\r\n      //   })\r\n      //   .then(function() {\r\n      //       console.log(\"Document successfully written to Archive!\");\r\n      //   })\r\n      //   .catch(function(error) {\r\n      //       console.error(\"Error writing document: \", error);\r\n      //   });        \r\n      //   self.firestore.doc(`users/${self.userUID}`).delete();\r\n      //   self.nacCtrl.navigateRoot(['./login'])\r\n      //   console.log(\"user deleted\")\r\n      // }).catch(function(error) {\r\n      //   console.log(error)\r\n      //   console.log(\"Error deleting user\")\r\n      // });\r\n    }\r\n  }\r\n\r\n  async presentAlertDelete() : Promise<boolean> {\r\n    let resolveFunction: (confirm: boolean) => void;\r\n    const promise = new Promise<boolean>(resolve => {\r\n      resolveFunction = resolve;\r\n    });\r\n    const alert = await this.alertCtrl.create({\r\n      header: 'Confirm Delete',\r\n      message: 'Are you sure you want to delete this account? This is a permanent deletion and cannot be undone. Please enter your password to continue',\r\n      inputs: [        \r\n        {\r\n          name: 'password',\r\n          placeholder: 'Password',\r\n          type: 'password'\r\n        }\r\n      ],\r\n      buttons: [\r\n        {\r\n          text: 'Cancel',\r\n          handler: () => resolveFunction(false)\r\n        },\r\n        {\r\n          text: 'Yes',\r\n          handler: data => {\r\n            this.afAuth.signInWithEmailAndPassword(firebase.auth().currentUser.email, data.password).then(function(){\r\n              console.log(\"signed in\")\r\n              resolveFunction(true)\r\n            }).catch(function(error){\r\n              console.log(error.message)\r\n            })           \r\n                      \r\n          }\r\n        }\r\n      ]\r\n    });\r\n\r\n    await alert.present();\r\n    return promise;\r\n  }\r\n}\r\n"],"sourceRoot":"webpack:///"}